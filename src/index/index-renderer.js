"use strict";
class SlackWorkspaceViewModel {
    constructor() {
        this.columnViews = [];
    }
    getColumns() { return this.columnViews; }
    addColumn(columnModel) {
        this.columnViews.push(columnModel);
    }
    getColumn(id) {
        return this.columnViews.find(x => x.getId() == id);
    }
    removeColumn(id) {
        this.columnViews = this.columnViews.filter(x => x.getId() != id);
    }
    removeAll() {
        // todo: viewと分離させる
        this.columnViews = [];
    }
}
class SlackColumnView {
    constructor(id, closeAction) {
        this.webviewItemDOM = document.createElement("div");
        this.webviewItemDOM.setAttribute("class", "webview-item");
        this.headerDOM = document.createElement("div");
        this.headerDOM.setAttribute("class", "slack-column-header");
        this.webviewItemDOM.appendChild(this.headerDOM);
        this.id = id;
        if (id == 0) {
            // todo: widthを設定から変えることができるように
            this.webviewItemDOM.setAttribute("style", "min-width:800px;");
        }
        else {
            this.webviewItemDOM.setAttribute("style", "min-width:400px;");
            const closeButtonDOM = document.createElement("button");
            closeButtonDOM.setAttribute("type", "button");
            closeButtonDOM.setAttribute("class", "slack-column-header-close-button");
            const closeButtonIconDivDOM = document.createElement("div");
            closeButtonIconDivDOM.setAttribute("class", "fas fa-times");
            closeButtonDOM.appendChild(closeButtonIconDivDOM);
            closeButtonDOM.addEventListener("click", () => closeAction(this));
            this.headerDOM.appendChild(closeButtonDOM);
        }
    }
    getDOM() { return this.webviewItemDOM; }
    getId() { return this.id; }
    isHomeColumn() { return this.id == 0; }
    getHeaderHeight() {
        return this.headerDOM.getBoundingClientRect().height;
    }
}
const slackWorkspaceView = new SlackWorkspaceViewModel();
window.onload = () => {
    window.addEventListener("scroll", () => {
        updateSlackColumnPositionReply();
    });
    // note: カラム追加
    const addColumnConfirmButtonDOM = document.getElementById("add-column-confirm-button");
    if (addColumnConfirmButtonDOM != null) {
        addColumnConfirmButtonDOM.addEventListener("click", () => {
            const addColumnInputDOM = (document.getElementById("add-column-input"));
            if (addColumnInputDOM == null) {
                return;
            }
            window.api.AddSlackColumnRequest(addColumnInputDOM.value);
            addColumnInputDOM.value = "";
        });
    }
    window.api.AddSlackColumnReply((url, id) => {
        AddSlackColumn(url, id);
    });
    window.api.UpdateSlackColumnPositionRequest(() => {
        updateSlackColumnPositionReply();
    });
    // note: 表示リロード
    const reloadWorkspaceButtonDOM = document.getElementById("reload-workspace-button");
    if (reloadWorkspaceButtonDOM != null) {
        reloadWorkspaceButtonDOM.addEventListener("click", () => {
            window.api.ReloadWorkspaceRequest();
            // todo: リロードリプライをもらって表示を更新する
        });
    }
    window.api.ReloadWorkspaceReply((urlList, idList) => {
        const webViewContainerDOM = document.getElementsByClassName("webview-container")[0];
        while (webViewContainerDOM.firstChild) {
            webViewContainerDOM.removeChild(webViewContainerDOM.firstChild);
        }
        slackWorkspaceView.removeAll();
        for (let i = 0; i < idList.length; i++) {
            AddSlackColumn(urlList[i], idList[i]);
        }
        updateSlackColumnPositionReply();
    });
    // note: workspace切り替えアイコン
    window.api.AddWorkspaceIconRequestM2R(workspaceIdList => {
        const workspaceIconContainer = document.getElementsByClassName("workspace-icon-container")[0];
        for (const workspaceId of workspaceIdList) {
            const workspaceIconButtonDOM = document.createElement("button");
            workspaceIconButtonDOM.innerText = workspaceId;
            workspaceIconButtonDOM.addEventListener("click", () => {
                window.api.OnClickedWorkspaceIconR2M(workspaceId);
            });
            workspaceIconContainer.appendChild(workspaceIconButtonDOM);
        }
    });
    window.api.InitIndex();
};
function AddSlackColumn(url, id) {
    const webviewContainerDOM = document.getElementsByClassName("webview-container")[0];
    const column = new SlackColumnView(id, (self) => {
        const column = slackWorkspaceView.getColumn(self.getId());
        if (column != null) {
            window.api.RemoveSlackColumnRequest(self.getId());
            slackWorkspaceView.removeColumn(self.getId());
            webviewContainerDOM.removeChild(self.getDOM());
            updateSlackColumnPositionReply();
        }
    });
    slackWorkspaceView.addColumn(column);
    webviewContainerDOM.appendChild(column.getDOM());
    window.api.OnAddedSlackColumn(url);
}
function updateSlackColumnPositionReply() {
    const [xPosList, yPosList, widthList, heightList] = getSlackColumnViewDomRects();
    window.api.UpdateSlackColumnPositionReply(xPosList, yPosList, widthList, heightList);
}
function getSlackColumnViewDomRects() {
    const xPosList = [];
    const yPosList = [];
    const widthList = [];
    const heightList = [];
    slackWorkspaceView.getColumns().forEach(x => {
        const rect = x.getDOM().getBoundingClientRect();
        const y = x.isHomeColumn() ?
            rect.y :
            rect.y + x.getHeaderHeight();
        const height = x.isHomeColumn() ?
            rect.height :
            rect.height - x.getHeaderHeight();
        xPosList.push(rect.x);
        yPosList.push(y);
        widthList.push(rect.width);
        heightList.push(height);
    });
    console.log(xPosList);
    console.log(yPosList);
    console.log(widthList);
    console.log(heightList);
    return [xPosList, yPosList, widthList, heightList];
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXgtcmVuZGVyZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC1yZW5kZXJlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsTUFBTSx1QkFBdUI7SUFBN0I7UUFFUyxnQkFBVyxHQUF1QixFQUFFLENBQUE7SUFvQjdDLENBQUM7SUFsQkEsVUFBVSxLQUFLLE9BQU8sSUFBSSxDQUFDLFdBQVcsQ0FBQSxDQUFDLENBQUM7SUFFeEMsU0FBUyxDQUFDLFdBQTRCO1FBQ3JDLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFBO0lBQ25DLENBQUM7SUFFRCxTQUFTLENBQUMsRUFBUztRQUNsQixPQUFPLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFBO0lBQ25ELENBQUM7SUFFRCxZQUFZLENBQUMsRUFBUztRQUNyQixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFBO0lBQ2pFLENBQUM7SUFFRCxTQUFTO1FBQ1IsbUJBQW1CO1FBQ25CLElBQUksQ0FBQyxXQUFXLEdBQUcsRUFBRSxDQUFBO0lBQ3RCLENBQUM7Q0FDRDtBQUVELE1BQU0sZUFBZTtJQU1wQixZQUFZLEVBQVMsRUFBRSxXQUEyQztRQUNqRSxJQUFJLENBQUMsY0FBYyxHQUFHLFFBQVEsQ0FBQyxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUE7UUFDbkQsSUFBSSxDQUFDLGNBQWMsQ0FBQyxZQUFZLENBQUMsT0FBTyxFQUFFLGNBQWMsQ0FBQyxDQUFBO1FBQ3pELElBQUksQ0FBQyxTQUFTLEdBQUcsUUFBUSxDQUFDLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQTtRQUM5QyxJQUFJLENB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